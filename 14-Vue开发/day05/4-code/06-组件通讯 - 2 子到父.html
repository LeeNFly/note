<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>
  <div id="app">
    <h1>{{ age }}</h1>

    <!-- 2 给子组件传递一个自定义事件 getmsg ，它的值是 getChildMsg 方法 -->
    <child @getmsg="getChildMsg"></child>
  </div>

  <script src="./vue.js"></script>
  <script>
    // 子到父：
    // 子组件：child组件
    // 父组件：vm实例

    // 步骤：
    // 1 父组件提供一个方法 (在methods中定义一个函数)
    //  这个方法将来子组件可以调用的，且形参会一一对应接收传递过来的实参值的, 数据通过方法的形参拿到
    // 2 将这个方法传递给子组件
    //    2.1 在子组件标签中定义一个自定义事件属性(指令) @事件名="函数引用地址(这里不需要写参数, 参数在methods中定义函数的地方写即可)", 将来由子组件去触发这个事件, 调用对应的函数
    // 3 由子组件触发这个方法，将要传递的数据作为方法的参数传递
    //    3.1 在子组件中, 通过vue实例.$emit('父组件传递过来的自定义事件名', 参数1, 参数2, ...), 会触发父组件中对应子组件标签上的对应自定义事件, 调用 ★ 父组件中其对应的函数(因为函数在父组件中, 所以this就指向了父组件vue实例), 并且将参数作为实参一一对应传递入, 执行函数体中代码
    //        这样, 在父组件的方法里, 就拿到了子组件传递过来的数据了, 即在父组件中, 就拿到了子组件中的数据了. 就可以在父组件中使用子组件传递过来的数据了
    // 注意: 1. 子组件传递给父组件的数据, 传递是也是值本身, 而不是传递变量,  传递前后没有影响, 且传递的数据赋值给了父组件中函数的形参了, 这个形参属于父组件, 与子组件再无关系了, 父组件可以任意操作这个形参, 比如重新赋值, 使用等其他所有操作...
    //       2. vue实例.$emit('父组件传递过来的自定义事件名', 参数1, 参数2, ...) 在调用完父组件中对应函数, 指向完函数体后, 会回到子组件中$emit这段代码的执行处, 继续往下执行之后的代码, 即同步执行
    //       3. 函数在哪声明的, 将来调用时就是在哪个组件/vue实例中调用的


    // 技巧： 我们知道, 在父子组件通讯过程中, 子组件是不能修改父组件传递过来的数据的, 如何解决?
    //       我们可以通过子 -> 父通信, 在子组件中调用父组件中的方法, 然后在父组件中去改变这个数据(父组件是可以改变自身组件中的数据的), 这样父组件数据发生改变, 页面重新渲染, 且会自动将改变后的数据重新传递给子组件, 子组件接收到新的数据后, 就会自动重新渲染页面并更新视图, 重新展示页面
    //       ★ 这种方法可以保证父组件传递给子组件的数据在父子组件中数据同步
    //       以后若在子组件中要修改父组件传递的数据, 都请使用以上方法进行修改
    const vm = new Vue({
      el: '#app',
      data: {
        age: 0
      },
      // 1 准备一个方法
      methods: {
        getChildMsg(data) {
          console.log('接受到子组件传递过来的数据为：', data)

          this.age = data
        }
      },
      components: {
        child: {
          template: `
            <div>
              <button @click="fn">传递数据给父组件</button>
            </div>
          `,
          methods: {
            fn() {
              // 3 触发父组件中传递过来的方法
              this.$emit('getmsg', 19)
              console.log(111)
            }
          }
        }
      }
    })
  </script>
</body>

</html>
